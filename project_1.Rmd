---
title: "Project 1"
author: "Yumin Wu"
date: "`r Sys.Date()`"
output: 
     html_vignette:
          toc: true
vignette: >
  %\VignetteIndexEntry{Project 1}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,message=FALSE,eval=TRUE,
  comment = "#>"
)
```

```{r}
library(httr)
library(jsonlite)
library(dplyr)
library(knitr)
```

# Introduction  
Read and summarize data from the National Hockey Leagueâ€™s (NHL) API.  

## Functions to contact the NHL records API and the NHL stats API.  
```{r}
get_franchise<-GET("https://records.nhl.com/site/api/franchise")
txt_franchise<-content(get_franchise, "text")
json_franchise<-fromJSON(txt_franchise,flatten = TRUE)
franchise<-json_franchise$data%>%select("id","firstSeasonId","lastSeasonId","teamCommonName")

```


```{r}
get_franchisett<-GET("https://records.nhl.com/site/api/franchise-team-totals")
txt_franchisett<-content(get_franchisett, "text")
json_franchisett<-fromJSON(txt_franchisett,flatten = TRUE)
franchise_team_total<-json_franchisett$data%>%select("franchiseId","homeTies","homeWins","roadTies","roadWins","shootoutLosses",
  "shootoutWins","shutouts","teamId","teamName","ties","wins")


```


```{r}
get_sr<-GET("https://records.nhl.com/site/api/franchise-season-records?cayenneExp=franchiseId=23")
txt_sr<-content(get_sr, "text")
json_sr<-fromJSON(txt_sr, flatten = TRUE)

```


```{r}
get_goalie23<-GET("https://records.nhl.com/site/api/franchise-goalie-records?cayenneExp=franchiseId=23")
txt_goalie23<-content(get_goalie23, "text")
json_goalie23<-fromJSON(txt_goalie23, flatten = TRUE)

```


```{r}
get_skater<-GET("https://records.nhl.com/site/api/franchise-skater-records?cayenneExp=franchiseId=23")
txt_skater<-content(get_skater, "text")
json_skater<-fromJSON(txt_skater, flatten = TRUE)
```


```{r}
get_teams<-GET("https://statsapi.web.nhl.com/api/v1/teams")
txt_teams<-content(get_teams, "text")
json_teams<-fromJSON(txt_teams, flatten = TRUE)
```


## Create a function for users to access any of the API endpoints above.  
```{r}
nhl<-function(full_url){
get<-GET(full_url)
txt_resp<-content(get, "text")
json_resp<-fromJSON(txt_resp, flatten = TRUE)
json_resp
}
```


## Data analysis  
```{r}
get_goalie27<-GET("https://records.nhl.com/site/api/franchise-goalie-records?cayenneExp=franchiseId=27")
txt_goalie27<-content(get_goalie27, "text")
json_goalie27<-fromJSON(txt_goalie27, flatten = TRUE)



goalie27v23<-rbind(json_goalie27$data,json_goalie23$data)
goalie27v23 <- goalie27v23[, c(4,5,1,2,21,3,8,11,16,17,18,19,20,22,23,24,25,26,27,28,29,9)]

goalie27v23$fullname<-paste(goalie27v23$firstName,goalie27v23$lastName)


df = data.frame(goalie27v23$fullname, goalie27v23$rookieWins ) 
df<-df%>%rename(playerFullname=goalie27v23.fullname,rookieWins=goalie27v23.rookieWins)

conTable<-table(df) 
print(conTable) 

```



### New Jersey Devils vs Colorado Avalanche summary of losses   
```{r}
franchiseId<-as.factor(goalie27v23$franchiseName)
sl<-goalie27v23 %>% 
  group_by(franchiseName) %>% 
  summarize(min=min(losses),q1 = quantile(losses, 0.25),mean = mean(losses),med=median(losses),q3 = quantile(losses, 0.75),max=max(losses)
            )
kable(sl,caption = ' New Jersey Devils vs Colorado Avalanche summary of losses')

```



### New Jersey Devils vs Colorado Avalanche summary of wins   
```{r}
sw<-goalie27v23 %>% 
  group_by(franchiseName) %>% 
  summarize(min=min(wins),q1 = quantile(wins, 0.25),mean = mean(wins),med=median(wins),q3 = quantile(wins, 0.75),max=max(wins)
            )
kable(sw,caption = 'New Jersey Devils vs Colorado Avalanche summary of wins')
```



### New Jersey Devils vs Colorado Avalanche summary of ties   
```{r}

st<-goalie27v23 %>% 
  group_by(franchiseName) %>% 
  summarize(min=min(ties),q1 = quantile(ties, 0.25,na.rm=TRUE),mean = mean(ties,na.rm=TRUE),med=median(ties,na.rm=TRUE),q3 = quantile(ties, 0.75,na.rm=TRUE),max=max(ties,na.rm=TRUE)
            )
kable(st,caption = 'New Jersey Devils vs Colorado Avalanche summary of st')


```

## Visuals  

```{r}
library(ggplot2)
g <- ggplot(goalie27v23, aes(x = franchiseName, y =wins))
g + geom_boxplot(stat = "boxplot", position = "dodge")+geom_jitter(aes(colour = franchiseName))+coord_cartesian(ylim = c(0,100))+labs(title="Boxplot for wins")
```


```{r}
g <- ggplot(goalie27v23, aes(x = losses))
g + geom_histogram(aes(y = ..density..),bins=20)+ geom_density(adjust = 0.4,size=3,color="red",outline.type = "full")+ labs(y = "Density")+labs(title="Histogram for losses")+ scale_x_continuous(breaks = seq(0, 400, 150))
```



```{r}
g <- ggplot(goalie27v23, aes(x=wins, y=losses))
g + geom_point(aes(color = franchiseName))+labs(title="wins vs losses")+geom_smooth(aes(group = franchiseName),method = lm,col="green")+scale_x_continuous(name = "wins", limits = c(0, 700))
```

```{r}
g <- ggplot(data = goalie27v23, aes(x = franchiseName,fill=franchiseName))
g + geom_bar()+labs(x='Franchise Name',y='No. of wins')
```


